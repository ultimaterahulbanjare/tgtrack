<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UTS ‚Äì Phase 1 Auth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    .shell {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    h1 {
      font-size: 24px;
      margin: 0 0 4px;
    }
    .muted { color: #9ca3af; font-size: 13px; }
    .tabs {
      display: flex;
      gap: 8px;
      margin-top: 20px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .tab-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: transparent;
      color: #e5e7eb;
      font-size: 13px;
      cursor: pointer;
    }
    .tab-btn.active {
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: #0b1120;
      border-color: transparent;
      font-weight: 600;
    }
    .card {
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top left,rgba(34,197,94,.08),transparent 55%);
      padding: 18px 16px 16px;
      margin-bottom: 18px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .pill {
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 11px;
      border: 1px solid #374151;
      color: #9ca3af;
    }
    form {
      display: grid;
      gap: 10px;
      margin-top: 4px;
    }
    label {
      font-size: 13px;
      margin-bottom: 3px;
      display: block;
    }
    input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
    }
    input:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,.3);
    }
    button.primary {
      margin-top: 4px;
      padding: 8px 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: #02140a;
    }
    button.secondary {
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: transparent;
      cursor: pointer;
      font-size: 12px;
      color: #e5e7eb;
    }
    .status {
      font-size: 12px;
      margin-top: 6px;
    }
    .status.ok { color: #4ade80; }
    .status.err { color: #f97373; }
    .status.neutral { color: #9ca3af; }
    .plans {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
      gap: 10px;
      margin: 8px 0 14px;
    }
    .plan-card {
      border-radius: 14px;
      border: 1px solid #1f2937;
      padding: 10px 10px 12px;
      cursor: pointer;
      background: #020617;
    }
    .plan-card.selected {
      border-color:#22c55e;
      box-shadow:0 0 0 1px rgba(34,197,94,.4);
      background:radial-gradient(circle at top,rgba(34,197,94,.12),#020617 60%);
    }
    .plan-name { font-weight:600;font-size:14px;margin-bottom:2px; }
    .plan-meta { font-size:12px;color:#9ca3af; }
    .tag {
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      font-size:11px;
      border:1px solid #374151;
      color:#d1d5db;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:6px;
      font-size:12px;
    }
    th,td {
      padding:6px 4px;
      border-bottom:1px solid #111827;
      text-align:left;
    }
    th {
      font-weight:500;
      color:#9ca3af;
      font-size:11px;
    }
    tr:last-child td { border-bottom:none; }
    .layout-two {
      display:grid;
      grid-template-columns:minmax(0,1.2fr) minmax(0,1fr);
      gap:16px;
    }
    @media (max-width:768px){
      .layout-two { grid-template-columns:minmax(0,1fr); }
    }
  
    /* --- Pro app layout additions --- */
    .app-shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }
    .app-title {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-dot {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #15803d);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:15px;
      font-weight:700;
      color:#022c22;
      box-shadow:0 0 0 1px rgba(34,197,94,0.35), 0 12px 30px rgba(22,163,74,0.45);
    }
    .app-title-text {
      display:flex;
      flex-direction:column;
    }
    .app-title-text h1 {
      font-size:18px;
      margin:0;
      color:#f9fafb;
    }
    .app-title-text span {
      font-size:12px;
      color:#9ca3af;
    }
    .env-pill {
      border-radius:999px;
      padding:3px 10px;
      border:1px solid #374151;
      font-size:11px;
      color:#9ca3af;
      background:rgba(15,23,42,0.85);
    }
    .app-body {
      display:flex;
      gap:16px;
      align-items:flex-start;
    }
    .app-nav {
      width:220px;
      min-width:200px;
    }
    .app-nav-group {
      font-size:11px;
      text-transform:uppercase;
      color:#6b7280;
      letter-spacing:0.04em;
      margin-bottom:6px;
      margin-top:14px;
    }
    .app-nav .tab-btn-pro {
      width:100%;
      text-align:left;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid transparent;
      background:transparent;
      color:#e5e7eb;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      cursor:pointer;
      margin-bottom:4px;
    }
    .app-nav .tab-btn-pro span {
      font-size:11px;
      color:#6b7280;
    }
    .app-nav .tab-btn-pro.active {
      background:linear-gradient(135deg,#111827,#020617);
      border-color:#374151;
    }
    .app-main {
      flex:1;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    @media (max-width:900px){
      .app-body {
        flex-direction:column;
      }
      .app-nav {
        width:100%;
        display:flex;
        flex-wrap:wrap;
        gap:6px;
      }
      .app-nav .tab-btn-pro {
        width:auto;
        flex:1;
      }
    }
</style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const API_BASE = '';

    function useStatus() {
      const [msg,setMsg] = useState('');
      const [type,setType] = useState('neutral');
      const set = (m,t='neutral') => { setMsg(m); setType(t); };
      return [msg,type,set];
    }

    function SignupCard() {
      const [plan,setPlan] = useState('starter');
      const [form,setForm] = useState({name:'',email:'',password:''});
      const [msg,typ,setMsg] = useStatus();
      const [loading,setLoading] = useState(false);

      const plans = [
        {id:'single',name:'Single',channels:1,note:'Perfect for 1 channel'},
        {id:'starter',name:'Starter',channels:3,note:'For small teams'},
        {id:'pro',name:'Pro',channels:5,note:'Scaling agencies'},
        {id:'agency',name:'Agency',channels:10,note:'Big setups'}
      ];

      const onChange = e => setForm({...form,[e.target.name]:e.target.value});

      const onSubmit = async (e) => {
        e.preventDefault();
        setMsg('', 'neutral');
        if (!form.name || !form.email || !form.password) {
          setMsg('Please fill all fields.', 'err');
          return;
        }
        setLoading(true);
        try {
          const res = await fetch(API_BASE + '/api/auth/signup', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
              name: form.name,
              email: form.email,
              password: form.password,
              plan
            })
          });
          const data = await res.json();
          if (!res.ok || !data.success) {
            setMsg(data.error || 'Signup failed', 'err');
          } else {
            setMsg('Account created! Wait for owner approval.', 'ok');
          }
        } catch (err) {
          console.error(err);
          setMsg('Network error during signup.', 'err');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="card">
          <div className="card-header">
            <div>
              <h2>Client signup</h2>
              <div className="muted">Select plan and create workspace.</div>
            </div>
            <div className="pill">Phase 1</div>
          </div>
          <div className="plans">
            {plans.map(p => (
              <div
                key={p.id}
                className={'plan-card ' + (plan===p.id?'selected':'')}
                onClick={() => setPlan(p.id)}
              >
                <div className="plan-name">{p.name}</div>
                <div className="plan-meta">Up to {p.channels} channels</div>
                <div className="muted" style={{fontSize:11,marginTop:3}}>{p.note}</div>
              </div>
            ))}
          </div>
          <form onSubmit={onSubmit}>
            <div>
              <label>Name / brand</label>
              <input
                name="name"
                value={form.name}
                onChange={onChange}
                placeholder="e.g. Rahul Trading Signals"
              />
            </div>
            <div>
              <label>Email</label>
              <input
                name="email"
                type="email"
                value={form.email}
                onChange={onChange}
                placeholder="you@example.com"
              />
            </div>
            <div>
              <label>Password</label>
              <input
                name="password"
                type="password"
                value={form.password}
                onChange={onChange}
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              />
            </div>
            <button className="primary" type="submit" disabled={loading}>
              {loading ? 'Creating‚Ä¶' : 'Create account'}
            </button>
          </form>
          {msg && <div className={'status ' + typ}>{msg}</div>}
        </div>
      );
    }

    function ClientLoginCard() {
      const [form,setForm] = useState({email:'',password:''});
      const [msg,typ,setMsg] = useStatus();
      const [loading,setLoading] = useState(false);

      const onChange = e => setForm({...form,[e.target.name]:e.target.value});

      const onSubmit = async (e) => {
        e.preventDefault();
        setMsg('', 'neutral');
        if (!form.email || !form.password) {
          setMsg('Please fill email & password.', 'err');
          return;
        }
        setLoading(true);
        try {
          const res = await fetch(API_BASE + '/api/auth/login', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(form)
          });
          const data = await res.json();
          if (!data.success) {
            if (data.status === 'pending') setMsg(data.message || 'Account pending approval.', 'neutral');
            else if (data.status === 'rejected') setMsg(data.message || 'Account rejected.', 'err');
            else setMsg(data.error || 'Login failed.', 'err');
          } else {
            setMsg('Logged in ‚úÖ Redirecting to dashboard‚Ä¶', 'ok');
            setTimeout(() => {
              window.location.href = '/panel';
            }, 800);
          }
        } catch (err) {
          console.error(err);
          setMsg('Network error during login.', 'err');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="card">
          <div className="card-header">
            <div>
              <h2>Client login</h2>
              <div className="muted">Use email/password after approval.</div>
            </div>
            <div className="pill">Client</div>
          </div>
          <form onSubmit={onSubmit}>
            <div>
              <label>Email</label>
              <input
                name="email"
                type="email"
                value={form.email}
                onChange={onChange}
                placeholder="you@example.com"
              />
            </div>
            <div>
              <label>Password</label>
              <input
                name="password"
                type="password"
                value={form.password}
                onChange={onChange}
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              />
            </div>
            <button className="primary" type="submit" disabled={loading}>
              {loading ? 'Signing in‚Ä¶' : 'Login'}
            </button>
          </form>
          {msg && <div className={'status ' + typ}>{msg}</div>}
        </div>
      );
    }

    function OwnerLoginCard() {
      const [form,setForm] = useState({email:'',password:''});
      const [msg,typ,setMsg] = useStatus();
      const [loading,setLoading] = useState(false);

      const onChange = e => setForm({...form,[e.target.name]:e.target.value});

      const onSubmit = async (e) => {
        e.preventDefault();
        setMsg('', 'neutral');
        if (!form.email || !form.password) {
          setMsg('Please fill email & password.', 'err');
          return;
        }
        setLoading(true);
        try {
          const res = await fetch(API_BASE + '/api/owner/login', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(form)
          });
          const data = await res.json();
          if (!data.success) setMsg(data.error || 'Owner login failed.', 'err');
          else {
            setMsg('Owner logged in ‚úÖ Redirecting‚Ä¶', 'ok');
            setTimeout(() => { window.location.href = '/dashboard'; }, 800);
          }
        } catch (err) {
          console.error(err);
          setMsg('Network error during owner login.', 'err');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="card">
          <div className="card-header">
            <div>
              <h2>Owner / admin login</h2>
              <div className="muted">Use seeded admin to approve clients.</div>
            </div>
            <div className="pill">Owner</div>
          </div>
          <form onSubmit={onSubmit}>
            <div>
              <label>Email</label>
              <input
                name="email"
                type="email"
                value={form.email}
                onChange={onChange}
                placeholder="admin@uts.local"
              />
            </div>
            <div>
              <label>Password</label>
              <input
                name="password"
                type="password"
                value={form.password}
                onChange={onChange}
                placeholder="Admin@123"
              />
            </div>
            <button className="primary" type="submit" disabled={loading}>
              {loading ? 'Signing in‚Ä¶' : 'Login as owner'}
            </button>
          </form>
          {msg && <div className={'status ' + typ}>{msg}</div>}
        </div>
      );
    }

    function OwnerPendingCard() {
      const [rows,setRows] = useState([]);
      const [msg,typ,setMsg] = useStatus();
      const [loading,setLoading] = useState(false);

      const load = async () => {
        setLoading(true);
        setMsg('', 'neutral');
        try {
          const res = await fetch(API_BASE + '/api/owner/clients/pending');
          const data = await res.json();
          if (!data.success) setMsg(data.error || 'Could not load pending clients.', 'err');
          else setRows(data.clients || []);
        } catch (err) {
          console.error(err);
          setMsg('Network error while loading clients.', 'err');
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => { load(); }, []);

      const act = async (id,mode) => {
        try {
          const res = await fetch(API_BASE + `/api/owner/clients/${id}/${mode}`, {
            method:'POST'
          });
          const data = await res.json();
          if (!data.success) setMsg(data.error || `Failed to ${mode} client.`, 'err');
          else {
            setMsg(`Client ${mode}d.`, 'ok');
            setRows(prev => prev.filter(r => r.id !== id));
          }
        } catch (err) {
          console.error(err);
          setMsg('Network error.', 'err');
        }
      };

      return (
        <div className="card">
          <div className="card-header">
            <div>
              <h2>Pending approvals</h2>
              <div className="muted">Read‚Äëonly list. Manage from Owner Super Dashboard.</div>
            </div>
            <button className="secondary" type="button" onClick={load}>Refresh</button>
          </div>
          {rows.length === 0 && (
            <div className="muted" style={{fontSize:12}}>No pending clients right now.</div>
          )}
          {rows.length > 0 && (
            <table>
              <thead>
                <tr>
                  <th>ID</th><th>Name</th><th>Slug</th><th>Plan</th><th>Max</th><th>Created</th>
                </tr>
              </thead>
              <tbody>
                {rows.map(r => (
                  <tr key={r.id}>
                    <td>{r.id}</td>
                    <td>{r.name}</td>
                    <td>{r.slug}</td>
                    <td><span className="tag">{r.plan}</span></td>
                    <td>{r.max_channels}</td>
                    <td>{r.created_at || '-'}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}
          {msg && <div className={'status ' + typ}>{msg}</div>}
        </div>
      );
    }

    function ClientMeCard() {
      const [info,setInfo] = useState(null);
      const [msg,typ,setMsg] = useStatus();

      const load = async () => {
        setMsg('', 'neutral');
        try {
          const res = await fetch(API_BASE + '/api/auth/me');
          const data = await res.json();
          if (!data.success) setMsg(data.error || 'Not logged in.', 'err');
          else {
            setInfo(data.user);
            setMsg('Session OK.', 'ok');
          }
        } catch (err) {
          console.error(err);
          setMsg('Network error.', 'err');
        }
      };

      useEffect(() => { load(); }, []);

      return (
        <div className="card">
          <div className="card-header">
            <div>
              <h2>Client session preview</h2>
              <div className="muted">This will power Phase 2 dashboard.</div>
            </div>
            <button className="secondary" type="button" onClick={load}>Refresh</button>
          </div>
          {info ? (
            <div style={{fontSize:13}}>
              <div><strong>Name:</strong> {info.name}</div>
              <div><strong>Email:</strong> {info.email}</div>
              <div><strong>Plan:</strong> {info.plan} (max {info.max_channels} channels)</div>
              <div><strong>Client ID:</strong> {info.client_id}</div>
              <div><strong>Slug:</strong> {info.slug}</div>
            </div>
          ) : (
            <div className="muted" style={{fontSize:12}}>
              Not logged in yet. Use client login tab first.
            </div>
          )}
          {msg && <div className={'status ' + typ}>{msg}</div>}
        </div>
      );
    }

    
    function ClientLpManager() {
      const [channels,setChannels] = useState([]);
      const [rows,setRows] = useState([]);
      const [loading,setLoading] = useState(false);
      const [msg,typ,setMsg] = useStatus();
      const [form,setForm] = useState({
        name: '',
        channel_id: '',
        template_key: 'generic',
        lp_event_mode: 'lead',
        anti_crawler: false,
        status: 'draft'
      });
      const [editingId,setEditingId] = useState(null);
      const [detail,setDetail] = useState(null);
      const [detailLoading,setDetailLoading] = useState(false);

      const resetForm = () => {
        setForm({
          name: '',
          channel_id: '',
          template_key: 'generic',
          lp_event_mode: 'lead',
          anti_crawler: false,
          status: 'draft'
        });
        setEditingId(null);
      };

      const load = async () => {
        setMsg('', 'neutral');
        setLoading(true);
        try {
          const [lpRes, chRes] = await Promise.all([
            fetch(API_BASE + '/api/client/landing-pages'),
            fetch(API_BASE + '/api/client/channels')
          ]);
          const lpJson = await lpRes.json();
          const chJson = await chRes.json();
          if (!lpJson.success) {
            setMsg(lpJson.message || lpJson.error || 'Failed to load landing pages.', 'err');
          } else {
            setRows(lpJson.landing_pages || []);
          }
          if (chJson.success && Array.isArray(chJson.channels)) {
            setChannels(chJson.channels);
          }
        } catch (err) {
          console.error(err);
          setMsg('Failed to load landing pages.', 'err');
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        load();
      }, []);

      const onChange = (e) => {
        const { name, value, type, checked } = e.target;
        setForm(prev => ({
          ...prev,
          [name]: type === 'checkbox' ? checked : value
        }));
      };

      const onSubmit = async (e) => {
        e.preventDefault();
        if (!form.name) {
          setMsg('Please enter an internal LP name.', 'err');
          return;
        }
        if (!form.channel_id) {
          setMsg('Please select a channel.', 'err');
          return;
        }
        setLoading(true);
        try {
          const payload = {
            name: form.name,
            channel_id: form.channel_id ? Number(form.channel_id) : null,
            template_key: form.template_key || 'generic',
            lp_event_mode: form.lp_event_mode || 'lead',
            anti_crawler: !!form.anti_crawler,
            status: form.status || 'draft'
          };
          const url = editingId
            ? API_BASE + '/api/client/landing-pages/' + editingId
            : API_BASE + '/api/client/landing-pages';
          const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!data.success) {
            setMsg(data.message || data.error || 'Failed to save landing page.', 'err');
          } else {
            setMsg(editingId ? 'Landing page updated.' : 'Landing page created.', 'ok');
            resetForm();
            load();
          }
        } catch (err) {
          console.error(err);
          setMsg('Failed to save landing page.', 'err');
        } finally {
          setLoading(false);
        }
      };

      const onStatusChange = async (id, status) => {
        setLoading(true);
        try {
          const body = { status };
          const res = await fetch(API_BASE + '/api/client/landing-pages/' + id, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          });
          const data = await res.json();
          if (!data.success) {
            setMsg(data.message || data.error || 'Failed to update status.', 'err');
          } else {
            setMsg('Status updated.', 'ok');
            load();
          }
        } catch (err) {
          console.error(err);
          setMsg('Failed to update status.', 'err');
        } finally {
          setLoading(false);
        }
      };

      const onEdit = (lp) => {
        setEditingId(lp.id);
        setForm({
          name: lp.name || '',
          channel_id: lp.channel_id ? String(lp.channel_id) : '',
          template_key: lp.template_key || 'generic',
          lp_event_mode: lp.lp_event_mode || 'lead',
          anti_crawler: !!lp.anti_crawler,
          status: lp.status || 'draft'
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      const onDuplicate = async (lp) => {
        setLoading(true);
        try {
          const res = await fetch(API_BASE + '/api/client/landing-pages/' + lp.id + '/duplicate', {
            method: 'POST'
          });
          const data = await res.json();
          if (!data.success) {
            setMsg(data.message || data.error || 'Failed to duplicate LP.', 'err');
          } else {
            setMsg('Landing page duplicated as draft.', 'ok');
            load();
          }
        } catch (err) {
          console.error(err);
          setMsg('Failed to duplicate LP.', 'err');
        } finally {
          setLoading(false);
        }
      };

      const onExportZip = (lp) => {
        const url = API_BASE + '/api/client/landing-pages/' + lp.id + '/export-zip';
        window.open(url, '_blank');
      };

      const openDetail = async (lp) => {
        setDetailLoading(true);
        setDetail(null);
        try {
          const res = await fetch(API_BASE + '/api/client/landing-pages/' + lp.id);
          const data = await res.json();
          if (!data.success) {
            setMsg(data.message || data.error || 'Failed to load LP analytics.', 'err');
          } else {
            setDetail(data);
          }
        } catch (err) {
          console.error(err);
          setMsg('Failed to load LP analytics.', 'err');
        } finally {
          setDetailLoading(false);
        }
      };

      return (
        <div className="layout-two">
          <div>
            <h2>Landing Page generator (beta)</h2>
            <div className="muted" style={{fontSize:12,marginBottom:10}}>
              Requires an active client session. Start with a simple LP per channel (max 10 published per channel).
            </div>
            <form onSubmit={onSubmit}>
              <div>
                <label>Internal LP name</label>
                <input
                  type="text"
                  name="name"
                  value={form.name}
                  onChange={onChange}
                  placeholder="Matchday v1 / Diwali Offer LP"
                />
              </div>
              <div>
                <label>Channel</label>
                <select
                  name="channel_id"
                  value={form.channel_id}
                  onChange={onChange}
                >
                  <option value="">Select a channel‚Ä¶</option>
                  {channels.map(ch => (
                    <option key={ch.id} value={ch.id}>
                      {(ch.telegram_title || ch.telegram_chat_id || 'Channel ' + ch.id) + ' (ID ' + ch.id + ')'}
                    </option>
                  ))}
                </select>
                <div className="muted" style={{fontSize:11,marginTop:3}}>
                  These are channels linked to your client workspace.
                </div>
              </div>
              <div>
                <label>Template</label>
                <select
                  name="template_key"
                  value={form.template_key}
                  onChange={onChange}
                >
                  <option value="generic">Generic promo</option>
                  <option value="forex">Forex signals</option>
                  <option value="cricket">Cricket prediction</option>
                  <option value="crypto">Crypto alerts</option>
                  <option value="personal">Personal brand</option>
                </select>
              </div>
              <div>
                <label>Event mapping (Option A)</label>
                <select
                  name="lp_event_mode"
                  value={form.lp_event_mode}
                  onChange={onChange}
                >
                  <option value="lead">InitiateLead ‚Üí Lead</option>
                  <option value="subscribe">InitiateSubscribe ‚Üí Subscribe</option>
                </select>
                <div className="muted" style={{fontSize:11}}>
                  One pixel = one main optimization event (Lead or Subscribe) across all LPs/channels.
                </div>
              </div>
              <div>
                <label>
                  <input
                    type="checkbox"
                    name="anti_crawler"
                    checked={!!form.anti_crawler}
                    onChange={onChange}
                  />{' '}
                  Enable anti-crawler for this LP
                </label>
              </div>
              <div>
                <label>Status</label>
                <select
                  name="status"
                  value={form.status}
                  onChange={onChange}
                >
                  <option value="draft">Draft</option>
                  <option value="published">Published</option>
                  <option value="archived">Archived</option>
                </select>
                <div className="muted" style={{fontSize:11}}>
                  Publishing respects the 10 published LPs per channel limit at backend.
                </div>
              </div>
              <button type="submit">
                {editingId ? (loading ? 'Saving‚Ä¶' : 'Update LP') : (loading ? 'Saving‚Ä¶' : 'Create LP')}
              </button>
              {editingId && (
                <button type="button" className="secondary" style={{marginLeft:8}} onClick={resetForm}>
                  Cancel edit
                </button>
              )}
              {msg && <div className={'msg ' + typ} style={{marginTop:8}}>{msg}</div>}
            </form>
          </div>

          <div>
            <h2>Your landing pages</h2>
            <div className="muted" style={{fontSize:12,marginBottom:6}}>
              Basic per-LP stats (views, pre-leads) via /lp2 + /api/v1/lp-event.
            </div>
            <button className="secondary" type="button" onClick={load}>
              {loading ? 'Refreshing‚Ä¶' : 'Refresh'}
            </button>
            {rows && rows.length ? (
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Channel</th>
                    <th>Template</th>
                    <th>Status</th>
                    <th>Views</th>
                    <th>Pre-leads</th>
                    <th>Auto URL</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {rows.map(r => (
                    <tr key={r.id}>
                      <td>{r.id}</td>
                      <td>
                        <button type="button" className="link-btn" onClick={() => openDetail(r)}>
                          {r.name}
                        </button>
                      </td>
                      <td>{r.telegram_title || ('Channel ' + r.channel_id)}</td>
                      <td>{r.template_key || '-'}</td>
                      <td>
                        <select
                          value={r.status}
                          onChange={(e) => onStatusChange(r.id, e.target.value)}
                          style={{padding:'3px 6px',borderRadius:999,border:'1px solid #374151',background:'#020617',color:'#e5e7eb',fontSize:11}}
                        >
                          <option value="draft">draft</option>
                          <option value="published">published</option>
                          <option value="archived">archived</option>
                        </select>
                      </td>
                      <td>{r.views || 0}</td>
                      <td>{r.pre_leads || 0}</td>
                      <td style={{fontSize:10}}>
                        {r.slug ? '/lp2/' + r.slug : '-'}
                      </td>
                      <td style={{fontSize:11,whiteSpace:'nowrap'}}>
                        <button type="button" className="link-btn" onClick={() => onEdit(r)}>Edit</button>
                        {' ¬∑ '}
                        <button type="button" className="link-btn" onClick={() => onDuplicate(r)}>Duplicate</button>
                        {' ¬∑ '}
                        <button type="button" className="link-btn" onClick={() => onExportZip(r)}>Export ZIP</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            ) : (
              <div className="muted" style={{fontSize:12,marginTop:6}}>
                No landing pages yet.
              </div>
            )}

            {detailLoading && (
              <div className="muted" style={{fontSize:12,marginTop:10}}>Loading LP analytics‚Ä¶</div>
            )}

            {detail && detail.landing_page && (
              <div className="card" style={{marginTop:12,padding:12,background:'#020617',border:'1px solid #1f2937'}}>
                <div style={{fontSize:13,fontWeight:600,marginBottom:4}}>
                  LP #{detail.landing_page.id}: {detail.landing_page.name}
                </div>
                <div className="muted" style={{fontSize:11,marginBottom:6}}>
                  Slug: {detail.landing_page.slug} ¬∑ Channel ID: {detail.landing_page.channel_id}
                </div>
                <div style={{display:'flex',gap:16,fontSize:12,marginBottom:8}}>
                  <div>Views: <strong>{detail.stats.totals.views}</strong></div>
                  <div>Pre-leads: <strong>{detail.stats.totals.pre_leads}</strong></div>
                  <div>Clicks: <strong>{detail.stats.totals.clicks}</strong></div>
                </div>
                {detail.stats.per_day && detail.stats.per_day.length ? (
                  <div style={{fontSize:11,marginTop:4}}>
                    <div style={{marginBottom:2}}>Last days:</div>
                    <ul>
                      {detail.stats.per_day.map(row => (
                        <li key={row.day}>
                          {row.day}: {row.views} views, {row.pre_leads} pre-leads, {row.clicks} clicks
                        </li>
                      ))}
                    </ul>
                  </div>
                ) : (
                  <div className="muted" style={{fontSize:11}}>No event data yet for this LP.</div>
                )}
              </div>
            )}
          </div>
        </div>
      );
    }

    function App() {
      const [tab,setTab] = useState('client-login');

      return (
        <div className="app-shell">
          <header className="app-header">
            <div className="app-title">
              <div className="logo-dot">U</div>
              <div className="app-title-text">
                <h1>Universal Tracking Console</h1>
                <span>Multi-client Telegram + Meta tracking workspace</span>
              </div>
            </div>
            <div className="env-pill">
              Phase 2 ¬∑ LP generator + SaaS auth
            </div>
          </header>

          <div className="app-body">
            <nav className="app-nav">
              <div className="app-nav-group">Client access</div>
              <button
                className={'tab-btn-pro ' + (tab === 'signup' ? 'active' : '')}
                onClick={() => setTab('signup')}
              >
                <div>
                  New client signup
                  <div><span>Self-service registration</span></div>
                </div>
                <div>‚ûï</div>
              </button>
              <button
                className={'tab-btn-pro ' + (tab === 'client-login' ? 'active' : '')}
                onClick={() => setTab('client-login')}
              >
                <div>
                  Client login
                  <div><span>Access your workspace</span></div>
                </div>
                <div>üîê</div>
              </button>
              <button
                className={'tab-btn-pro ' + (tab === 'client-me' ? 'active' : '')}
                onClick={() => setTab('client-me')}
              >
                <div>
                  Client profile
                  <div><span>Plan, limits & keys</span></div>
                </div>
                <div>üë§</div>
              </button>

              <div className="app-nav-group">Landing pages</div>
              <button
                className={'tab-btn-pro ' + (tab === 'lp' ? 'active' : '')}
                onClick={() => setTab('lp')}
              >
                <div>
                  LP generator
                  <div><span>Create, edit, analytics</span></div>
                </div>
                <div>üìÑ</div>
              </button>

              <div className="app-nav-group">Owner / admin</div>
              <button
                className={'tab-btn-pro ' + (tab === 'owner' ? 'active' : '')}
                onClick={() => setTab('owner')}
              >
                <div>
                  Owner approvals
                  <div><span>Review & activate clients</span></div>
                </div>
                <div>üõ°Ô∏è</div>
              </button>
            </nav>

            <main className="app-main">
              {tab === 'signup' && <SignupCard />}

              {tab === 'client-login' && (
                <div className="layout-two">
                  <ClientLoginCard />
                  <ClientMeCard />
                </div>
              )}

              {tab === 'client-me' && <ClientMeCard />}

              {tab === 'lp' && <ClientLpManager />}

              {tab === 'owner' && (
                <div className="layout-two">
                  <OwnerLoginCard />
                  <OwnerPendingCard />
                </div>
              )}
            </main>
          </div>
        </div>
      );
    }
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
