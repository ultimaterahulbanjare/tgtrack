<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Telegram Funnel – Client Panel (Phase 1 + 2)</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <style>
      * {
        box-sizing: border-box;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
          sans-serif;
      }

      body {
        margin: 0;
        padding: 0;
        background: #050816;
        color: #e5e7eb;
      }

      .app-shell {
        max-width: 1040px;
        margin: 0 auto;
        padding: 24px 16px 40px;
      }

      .card {
        background: linear-gradient(135deg, #0b1120, #020617);
        border-radius: 18px;
        padding: 20px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.6);
      }

      .heading {
        font-size: 24px;
        font-weight: 700;
        letter-spacing: 0.02em;
        margin-bottom: 6px;
      }

      .subheading {
        font-size: 13px;
        color: #9ca3af;
        margin-bottom: 16px;
      }

      .tabs {
        display: inline-flex;
        background: rgba(15, 23, 42, 0.8);
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        padding: 3px;
        margin-top: 8px;
        margin-bottom: 20px;
      }

      .tab-btn {
        border: none;
        background: transparent;
        color: #9ca3af;
        padding: 6px 14px;
        font-size: 13px;
        border-radius: 999px;
        cursor: pointer;
        transition: all 0.16s ease-out;
      }

      .tab-btn.active {
        background: radial-gradient(circle at top left, #22c55e, #16a34a);
        color: #020617;
        font-weight: 600;
        box-shadow: 0 12px 25px rgba(34, 197, 94, 0.45);
      }

      .grid {
        display: grid;
        gap: 16px;
      }

      @media (min-width: 900px) {
        .grid-2 {
          grid-template-columns: 1.1fr 0.9fr;
        }
        .grid-3 {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }

      .label {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 4px;
      }

      .input,
      .select,
      .textarea {
        width: 100%;
        background: #020617;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        padding: 9px 11px;
        font-size: 13px;
        color: #e5e7eb;
        outline: none;
        transition: border 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
      }

      .input:focus,
      .select:focus,
      .textarea:focus {
        border-color: #22c55e;
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
        background: #020617;
      }

      .textarea {
        min-height: 72px;
        resize: vertical;
      }

      .btn {
        border: none;
        border-radius: 999px;
        padding: 8px 16px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: all 0.16s ease-out;
      }

      .btn-primary {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: #020617;
        box-shadow: 0 14px 30px rgba(34, 197, 94, 0.5);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 40px rgba(34, 197, 94, 0.65);
      }

      .btn-ghost {
        background: transparent;
        color: #9ca3af;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #9ca3af;
      }

      .pill-badge {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
      }

      .pill-pending {
        background: rgba(234, 179, 8, 0.06);
        border-color: rgba(234, 179, 8, 0.6);
        color: #eab308;
      }

      .pill-rejected {
        background: rgba(239, 68, 68, 0.06);
        border-color: rgba(239, 68, 68, 0.6);
        color: #f87171;
      }

      .plan-grid {
        display: grid;
        gap: 10px;
        margin-top: 10px;
      }

      @media (min-width: 640px) {
        .plan-grid {
          grid-template-columns: repeat(4, minmax(0, 1fr));
        }
      }

      .plan-card {
        border-radius: 16px;
        padding: 10px 10px 12px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.85);
        cursor: pointer;
        transition: all 0.16s ease-out;
      }

      .plan-card.active {
        border-color: #22c55e;
        box-shadow: 0 10px 22px rgba(34, 197, 94, 0.35);
        background: radial-gradient(circle at top left, #16a34a, #020617);
      }

      .plan-name {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .plan-desc {
        font-size: 11px;
        color: #9ca3af;
      }

      .plan-badge {
        font-size: 11px;
        margin-top: 4px;
        color: #22c55e;
      }

      .small {
        font-size: 11px;
        color: #9ca3af;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
        font-size: 12px;
      }

      th,
      td {
        padding: 6px 8px;
        border-bottom: 1px solid rgba(30, 64, 175, 0.6);
      }

      th {
        text-align: left;
        font-size: 11px;
        color: #9ca3af;
        font-weight: 500;
      }

      tr:hover td {
        background: rgba(15, 23, 42, 0.9);
      }

      .chip {
        font-size: 11px;
        padding: 2px 7px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.55);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        display: inline-block;
        margin-right: 4px;
      }

      .status-active {
        background: #22c55e;
      }

      .status-paused {
        background: #eab308;
      }

      .status-disabled {
        background: #f97316;
      }

      .muted {
        font-size: 11px;
        color: #6b7280;
      }

      .error {
        font-size: 12px;
        color: #f97373;
        margin-top: 4px;
      }

      .success {
        font-size: 12px;
        color: #4ade80;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <div class="card">
        <div
          style="
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
          "
        >
          <div>
            <div class="heading">Telegram Funnel – Client Access</div>
            <div class="subheading">
              Self-signup with a plan, wait for owner approval, then manage
              channels & CAPI config in one place.
            </div>
          </div>
          <div style="display: flex; flex-direction: column; gap: 6px">
            <div class="pill">
              <span class="pill-badge"></span>
              <span>Universal Tracking Workspace</span>
            </div>
            <div class="small">
              Cookie: <code>auth</code> · Multi-tenant DB · Meta CAPI + Telegram
              joins
            </div>
          </div>
        </div>

        <div id="root" style="margin-top: 16px"></div>
      </div>
    </div>

    <!-- React + ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script>
      const e = React.createElement;

      const PLAN_CONFIG = [
        { key: 'single', name: 'Single', max: 1 },
        { key: 'starter', name: 'Starter', max: 3 },
        { key: 'pro', name: 'Pro', max: 5 },
        { key: 'agency', name: 'Agency', max: 10 },
      ];

      function PlanSelector({ value, onChange }) {
        return React.createElement(
          'div',
          null,
          React.createElement(
            'div',
            { className: 'label' },
            'Select your plan (Phase 1)'
          ),
          React.createElement(
            'div',
            { className: 'plan-grid' },
            PLAN_CONFIG.map((p) =>
              React.createElement(
                'div',
                {
                  key: p.key,
                  className:
                    'plan-card ' + (value === p.key ? 'active' : ''),
                  onClick: () => onChange(p.key),
                },
                React.createElement('div', { className: 'plan-name' }, p.name),
                React.createElement(
                  'div',
                  { className: 'plan-desc' },
                  p.max === 1
                    ? '1 active channel'
                    : p.max + ' active channels'
                ),
                React.createElement(
                  'div',
                  { className: 'plan-badge' },
                  'Perfect for ',
                  p.key === 'single'
                    ? 'solo channel'
                    : p.key === 'starter'
                    ? 'new creators'
                    : p.key === 'pro'
                    ? 'agencies'
                    : 'high volume scaling'
                )
              )
            )
          )
        );
      }

      function SignupForm({ onDone }) {
        const [name, setName] = React.useState('');
        const [email, setEmail] = React.useState('');
        const [password, setPassword] = React.useState('');
        const [plan, setPlan] = React.useState('starter');
        const [loading, setLoading] = React.useState(false);
        const [message, setMessage] = React.useState('');
        const [error, setError] = React.useState('');

        async function handleSubmit(ev) {
          ev.preventDefault();
          setError('');
          setMessage('');
          setLoading(true);
          try {
            const res = await fetch('/api/auth/signup', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                name,
                email,
                password,
                plan,
              }),
            });
            const data = await res.json();
            if (!data.success) {
              setError(data.error || 'Failed to create account');
            } else {
              setMessage(
                data.message ||
                  'Account created. Wait for owner approval, then login.'
              );
              if (onDone) onDone();
            }
          } catch (err) {
            console.error(err);
            setError('Network error.');
          } finally {
            setLoading(false);
          }
        }

        return React.createElement(
          'form',
          { onSubmit: handleSubmit },
          React.createElement(
            'div',
            { className: 'grid grid-2' },
            React.createElement(
              'div',
              null,
              React.createElement('div', { className: 'label' }, 'Name'),
              React.createElement('input', {
                className: 'input',
                value: name,
                onChange: (e) => setName(e.target.value),
                required: true,
                placeholder: 'Your name / brand name',
              })
            ),
            React.createElement(
              'div',
              null,
              React.createElement('div', { className: 'label' }, 'Email'),
              React.createElement('input', {
                className: 'input',
                type: 'email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                required: true,
                placeholder: 'you@example.com',
              })
            )
          ),
          React.createElement(
            'div',
            { style: { marginTop: 10 } },
            React.createElement('div', { className: 'label' }, 'Password'),
            React.createElement('input', {
              className: 'input',
              type: 'password',
              value: password,
              onChange: (e) => setPassword(e.target.value),
              required: true,
              placeholder: 'Min 6 characters',
            })
          ),
          React.createElement(
            'div',
            { style: { marginTop: 10 } },
            React.createElement(PlanSelector, {
              value: plan,
              onChange: setPlan,
            })
          ),
          React.createElement(
            'div',
            {
              style: {
                marginTop: 14,
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                gap: 8,
              },
            },
            React.createElement(
              'button',
              {
                type: 'submit',
                className: 'btn btn-primary',
                disabled: loading,
              },
              loading ? 'Creating…' : 'Create account'
            ),
            React.createElement(
              'div',
              { className: 'small' },
              'Owner will approve your workspace. You can then login from the Login tab.'
            )
          ),
          error && React.createElement('div', { className: 'error' }, error),
          message &&
            React.createElement('div', { className: 'success' }, message)
        );
      }

      function LoginForm({ onLoggedIn }) {
        const [email, setEmail] = React.useState('');
        const [password, setPassword] = React.useState('');
        const [loading, setLoading] = React.useState(false);
        const [error, setError] = React.useState('');
        const [info, setInfo] = React.useState('');

        async function handleSubmit(ev) {
          ev.preventDefault();
          setError('');
          setInfo('');
          setLoading(true);
          try {
            const res = await fetch('/api/auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, password }),
            });
            const data = await res.json();
            if (!data.success) {
              if (data.status === 'pending') {
                setInfo(data.message || 'Pending approval.');
              } else if (data.status === 'rejected') {
                setError(data.message || 'Account rejected.');
              } else {
                setError(data.error || 'Invalid credentials');
              }
            } else {
              setInfo('Logged in successfully.');
              if (onLoggedIn) onLoggedIn(data.user);
            }
          } catch (err) {
            console.error(err);
            setError('Network error.');
          } finally {
            setLoading(false);
          }
        }

        return React.createElement(
          'form',
          { onSubmit: handleSubmit },
          React.createElement(
            'div',
            { className: 'grid grid-2' },
            React.createElement(
              'div',
              null,
              React.createElement('div', { className: 'label' }, 'Email'),
              React.createElement('input', {
                className: 'input',
                type: 'email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                required: true,
                placeholder: 'you@example.com',
              })
            ),
            React.createElement(
              'div',
              null,
              React.createElement('div', { className: 'label' }, 'Password'),
              React.createElement('input', {
                className: 'input',
                type: 'password',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                required: true,
              })
            )
          ),
          React.createElement(
            'div',
            { style: { marginTop: 14 } },
            React.createElement(
              'button',
              {
                type: 'submit',
                className: 'btn btn-primary',
                disabled: loading,
              },
              loading ? 'Logging in…' : 'Login'
            )
          ),
          error && React.createElement('div', { className: 'error' }, error),
          info && React.createElement('div', { className: 'success' }, info),
          React.createElement(
            'div',
            { className: 'small', style: { marginTop: 6 } },
            'Tip: After login, open the Dashboard tab to manage channels.'
          )
        );
      }

      function ChannelsTable({ channels }) {
        if (!channels || channels.length === 0) {
          return React.createElement(
            'div',
            { className: 'muted', style: { marginTop: 6 } },
            'No channels added yet (Phase 2 backend APIs need to be wired).'
          );
        }

        return React.createElement(
          'table',
          null,
          React.createElement(
            'thead',
            null,
            React.createElement(
              'tr',
              null,
              React.createElement('th', null, 'Channel'),
              React.createElement('th', null, 'Telegram ID'),
              React.createElement('th', null, 'Pixel'),
              React.createElement('th', null, 'Today / 7d / Total'),
              React.createElement('th', null, 'Status')
            )
          ),
          React.createElement(
            'tbody',
            null,
            channels.map((ch) =>
              React.createElement(
                'tr',
                { key: ch.id },
                React.createElement('td', null, ch.telegram_title || '—'),
                React.createElement(
                  'td',
                  null,
                  React.createElement(
                    'span',
                    { className: 'chip' },
                    ch.telegram_chat_id
                  )
                ),
                React.createElement(
                  'td',
                  null,
                  React.createElement(
                    'span',
                    { className: 'muted' },
                    ch.pixel_id || '—'
                  )
                ),
                React.createElement(
                  'td',
                  null,
                  React.createElement(
                    'div',
                    { style: { fontSize: 11 } },
                    (ch.stats && ch.stats.today) || 0,
                    ' / ',
                    (ch.stats && ch.stats.last7) || 0,
                    ' / ',
                    (ch.stats && ch.stats.total) || 0
                  )
                ),
                React.createElement(
                  'td',
                  null,
                  React.createElement('span', { className: 'chip' }, 'Active')
                )
              )
            )
          )
        );
      }

      function DashboardSkeleton() {
        const [summary, setSummary] = React.useState(null);
        const [channels, setChannels] = React.useState([]);
        const [status, setStatus] = React.useState(
          'Phase 2 backend APIs need to be wired on /api/client/...'
        );

        // Only try /api/auth/me for now (just to show logged in user)
        React.useEffect(() => {
          (async () => {
            try {
              const res = await fetch('/api/auth/me');
              const data = await res.json();
              if (data && data.success && data.user) {
                setSummary({
                  client: {
                    name: data.user.name,
                    email: data.user.email,
                    plan: data.user.plan,
                    max_channels: data.user.max_channels,
                  },
                });
                setStatus(
                  'Logged in as ' +
                    (data.user.email || data.user.name || 'client') +
                    '. Backend-side Phase 2 endpoints still to be added.'
                );
              } else {
                setStatus('Not logged in as client.');
              }
            } catch (err) {
              console.error(err);
              setStatus('Network error while checking session.');
            }
          })();
        }, []);

        const clientInfo = summary && summary.client;

        return React.createElement(
          'div',
          { className: 'grid grid-2' },
          React.createElement(
            'div',
            null,
            React.createElement(
              'div',
              { className: 'label' },
              'Plan & usage (placeholder)'
            ),
            clientInfo &&
              React.createElement(
                'div',
                {
                  style: {
                    display: 'flex',
                    gap: 8,
                    alignItems: 'center',
                    marginTop: 6,
                  },
                },
                React.createElement(
                  'span',
                  { className: 'chip' },
                  clientInfo.plan?.toUpperCase(),
                  ' · ',
                  clientInfo.max_channels,
                  ' channels'
                )
              ),
            React.createElement(
              'div',
              { className: 'small', style: { marginTop: 8 } },
              'Once Phase 2 backend APIs are in place, this section will show total joins (today, 7 days, lifetime) and channel usage.'
            ),
            React.createElement(
              'div',
              { style: { marginTop: 16 } },
              React.createElement(
                'div',
                { className: 'label' },
                'Channels (placeholder)'
              ),
              React.createElement(ChannelsTable, { channels })
            )
          ),
          React.createElement(
            'div',
            null,
            React.createElement(
              'div',
              { className: 'label' },
              'Channel & CAPI config (placeholder UI)'
            ),
            React.createElement(
              'div',
              { className: 'small', style: { marginTop: 8 } },
              'Here you will be able to add/edit Telegram channels, per-channel pixel & Meta access token, and LP URL. For now, we are only shipping the frontend skeleton.'
            ),
            React.createElement(
              'div',
              { style: { marginTop: 12 } },
              React.createElement(
                'div',
                { className: 'label' },
                'Telegram Chat ID'
              ),
              React.createElement('input', {
                className: 'input',
                placeholder: '-1001234567890',
                disabled: true,
              })
            ),
            React.createElement(
              'div',
              { style: { marginTop: 8 } },
              React.createElement(
                'div',
                { className: 'label' },
                'Pixel ID (per-channel override)'
              ),
              React.createElement('input', {
                className: 'input',
                placeholder: '123456789012345',
                disabled: true,
              })
            ),
            React.createElement(
              'div',
              { style: { marginTop: 8 } },
              React.createElement(
                'div',
                { className: 'label' },
                'Meta Access Token (per-channel)'
              ),
              React.createElement('input', {
                className: 'input',
                placeholder: 'EAAG…',
                disabled: true,
              })
            ),
            React.createElement(
              'div',
              { style: { marginTop: 8 } },
              React.createElement(
                'div',
                { className: 'label' },
                'Landing Page URL'
              ),
              React.createElement('input', {
                className: 'input',
                placeholder: 'https://yourlp.netlify.app/…',
                disabled: true,
              })
            )
          ),
          React.createElement(
            'div',
            { style: { gridColumn: '1 / -1', marginTop: 10 } },
            React.createElement('div', { className: 'muted' }, status)
          )
        );
      }

      function App() {
        const [tab, setTab] = React.useState('signup');
        const [user, setUser] = React.useState(null);

        function handleLoggedIn(u) {
          setUser(u);
          setTab('dashboard');
        }

        function handleSignupDone() {
          setTab('login');
        }

        return React.createElement(
          'div',
          null,
          React.createElement(
            'div',
            { className: 'tabs' },
            React.createElement(
              'button',
              {
                type: 'button',
                className:
                  'tab-btn ' + (tab === 'signup' ? 'active' : ''),
                onClick: () => setTab('signup'),
              },
              'Sign up'
            ),
            React.createElement(
              'button',
              {
                type: 'button',
                className:
                  'tab-btn ' + (tab === 'login' ? 'active' : ''),
                onClick: () => setTab('login'),
              },
              'Login'
            ),
            React.createElement(
              'button',
              {
                type: 'button',
                className:
                  'tab-btn ' + (tab === 'dashboard' ? 'active' : ''),
                onClick: () => setTab('dashboard'),
              },
              'Dashboard (Phase 2 skeleton)'
            )
          ),
          tab === 'signup' &&
            React.createElement(SignupForm, { onDone: handleSignupDone }),
          tab === 'login' &&
            React.createElement(LoginForm, { onLoggedIn: handleLoggedIn }),
          tab === 'dashboard' && React.createElement(DashboardSkeleton, null)
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(
        React.createElement(App)
      );
    </script>
  </body>
</html>
